pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                checkout([$class: 'GitSCM', branches: [[name: '*/master']],
                         userRemoteConfigs: [[url: 'https://github.com/mahmoudbelka2022/AdamMahWeb.git']]])
            }
        }
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }
        stage('Cucumber Report') {
            steps {
                sh 'mvn verify'
                cucumber buildStatus: "UNSTABLE",
                fileIncludePattern: "**/cucumber.json",
                jsonReportDirectory: 'target',
                emailext (
                                        to: 'kamalbelkati@gmail.com',
                                        subject: "Jenkins Build",
                                        body: "The build has completed",
                                        attachLog: true,
                                        mimeType: 'text/html',
                                        from: 'jenkins@example.com',
                                        replyTo: 'admin@example.com',
                                        smtpServer: 'smtp.gmail.com',
                                        smtpPort: 465,
                                        // replace with your username and password
                                        credentialsId: 'belkati2017@gmail.com/Mamabga84@'
                                    )
            }
        }

    }
}
